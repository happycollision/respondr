/*! respondr - v0.2.1 - 2015-02-05
* https://github.com/happycollision/respondr
* Copyright (c) 2015 Don Denton; Licensed MIT */
!function(a){a.fn.respondr=function(b,c){var d={},e={};("string"!=typeof b||b.length<1)&&(b="100vw"),c!==!0&&"only"!==c&&(c=!1);var f=function(d){if("ok"!==d.stat)return"no images";var e="",f=new Image,g=[];return a.each(d.sizes.size,function(a,b){var d=function(){g.push(b.source+" "+b.width+"w")},e=-1!==b.label.indexOf("Square");return c===!0?void d():c!==!1||e?void("only"===c&&e&&d()):void d()}),g=g.join(","),f.srcset=g,f.sizes=b,e=f},g=function(a){var b=/ *gallery (.*)/i,c=a.match(b);return null!==c?["gallery",c[1]]:["image",a]},h=function(b){var c=/\[ {0,1}respondr (.*?)\]/gi,f=a(b).html().replace(c,function(b,c){var f=g(c);return"image"===f[0]?(d[f[1]]=a.respondr(f[1]),'<span class="respondr-return" data-respondr-id="'+c+'">replacing image</span>'):"gallery"===f[0]?(e[f[1]]=a.respondr.gallery(f[1]),'<div class="respondr-return-gallery" data-respondr-id="'+f[1]+'"></div>'):void 0});a(b).html(f)};return this.each(function(){h(this);var b=a(".respondr-return");a.each(d,function(c,d){d.done(function(d){var e=f(d),g=b.filter("[data-respondr-id='"+c+"']");if(g.html("").append(e),a.respondr.options.usePicturefill)if("function"==typeof window.picturefill)window.picturefill();else{window.console.log("Tried to call picturefill(), but it does not exist. Trying again in 2 seconds.");var h=function(){"function"==typeof window.picturefill?window.picturefill():window.console.log("Still no picturefill(). Giving up.")};setTimeout(function(){h()},2e3)}a.respondr.options.callback(g)})}),a.each(e,function(b,c){c.done(function(c){var d=a(".respondr-return-gallery").filter("[data-respondr-id='"+b+"']");a.each(c.photoset.photo,function(a,b){d.append("[respondr "+b.id+"]")}),d.respondr()})})})},a.respondr=function(b){var c="flickr.photos.getSizes",d="json";if(null===b||"undefined"==typeof b)throw"$.respondr() expects an argument. None given.";if("object"!=typeof b){if("string"==typeof b||"number"==typeof b){var e=b;return a.ajax({url:"https://api.flickr.com/services/rest/",data:{method:c,format:d,api_key:a.respondr.options.apiKey,photo_id:e,nojsoncallback:1}})}throw"$.respondr() was given an invalid argument."}a.extend(a.respondr.options,b)},a.respondr.options={apiKey:"",usePicturefill:!1,callback:function(){}},a.respondr.gallery=function(b){return a.ajax({url:"https://api.flickr.com/services/rest/",data:{method:"flickr.photosets.getPhotos",format:"json",api_key:a.respondr.options.apiKey,photoset_id:b,nojsoncallback:1}})}}(jQuery);